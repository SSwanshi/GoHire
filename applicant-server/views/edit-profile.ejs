<%- include('layout/header') %>
    <nav class="bg-blue-500 p-5 shadow-xl fixed w-full z-10 transition-all duration-300" id="navbar">
        <div class="container mx-auto flex justify-between items-center">
            <a href="/"
                class="text-black text-3xl font-bold transition-transform hover:scale-105 duration-300 ml-2">Go<span
                    class="text-yellow-400">Hire</span></a>

            <div class="relative w-1/3 group">
                <form action="/search" method="POST" id="search-form">
                    <input id="search-space" type="text" placeholder="Search for Opportunities" name="parsedValue"
                        class="w-full p-3 rounded-full border-2 border-blue-300 focus:outline-none focus:ring-2 focus:ring-yellow-400 transition-all duration-300 shadow-md placeholder:text-gray-700">
                </form>
                <div class="absolute right-3 top-3.5 text-yellow-500">
                    <a href="/search" id="search-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor" stroke-width="4">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </a>
                </div>
            </div>

            <ul class="hidden md:flex space-x-8 text-white">
                <li><a href="/" class="hover:text-yellow-300 transition-colors duration-300 font-extrabold">Home</a>
                </li>
                <li><a href="/jobs" class="hover:text-yellow-300 transition-colors duration-300 font-extrabold">Jobs</a>
                </li>
                <li><a href="/internships"
                        class="hover:text-yellow-300 transition-colors duration-300 font-extrabold">Internship</a></li>
                <li><a href="/contact"
                        class="hover:text-yellow-300 transition-colors duration-300 font-extrabold">Contact
                        Us</a></li>
                <% if (user) { %>
                    <li class="relative group">
                        <button
                            class="bg-yellow-400 hover:bg-yellow-500 text-blue-800 font-black py-2 px-4 rounded-full transition-all duration-300 hover:shadow-lg flex items-center">
                            <% if (user.profileImageId) { %>
                                <img src="/profile/image"
                                    class="w-8 h-8 rounded-full object-cover mr-2 border-2 border-blue-800"
                                    alt="Profile Image">
                                <% } else { %>
                                    <div
                                        class="w-8 h-8 rounded-full bg-blue-800 text-white flex items-center justify-center mr-2 font-bold text-sm">
                                        <%= user.firstName.charAt(0).toUpperCase() %>
                                    </div>
                                    <% } %>
                                        <%= user.firstName || 'Profile' %>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none"
                                                viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M19 9l-7 7-7-7" />
                                            </svg>
                        </button>
                        <div
                            class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 z-50 transform -translate-y-2 group-hover:translate-y-0">
                            <a href="/profile" class="block px-4 py-2 text-blue-800 hover:bg-blue-50 rounded-t-lg">My
                                Profile</a>
                            <a href="/logout"
                                class="block px-4 py-2 text-blue-800 hover:bg-blue-50 rounded-b-lg">Logout</a>
                        </div>
                    </li>
                    <% } else { %>
                        <li><a href="/login"
                                class="bg-yellow-400 hover:bg-yellow-500 text-blue-800 font-black py-2 px-6 rounded-full transition-all duration-300 hover:shadow-lg">Login</a>
                        </li>
                        <% } %>
            </ul>

            <div class="md:hidden relative" id="mobile-menu-container">
                <div class="flex flex-col space-y-1 cursor-pointer" id="mobile-menu">
                    <span class="block w-6 h-0.5 bg-white transition-all duration-300"></span>
                    <span class="block w-6 h-0.5 bg-white transition-all duration-300"></span>
                    <span class="block w-6 h-0.5 bg-white transition-all duration-300"></span>
                </div>
                <ul id="dropdown-menu"
                    class="absolute right-0 mt-10 w-140 bg-yellow-500 text-blue-500 rounded-lg shadow-lg hidden text-blue-800 flex justify-center flex-col">
                    <li><a href="/" class="block px-4 py-2 hover:bg-blue-500 hover:text-yellow-500 text-center">Home</a>
                    </li>
                    <li><a href="/jobs"
                            class="block px-4 py-2 hover:bg-blue-500 hover:text-yellow-500 text-center">Jobs</a></li>
                    <li><a href="/internships"
                            class="block px-4 py-2 hover:bg-blue-500 hover:text-yellow-500 text-center">Internships</a>
                    </li>
                    <li><a href="/contact"
                            class="block px-4 py-2 hover:bg-blue-500 hover:text-yellow-500 text-center">Contact
                            Us</a></li>

                    <% if (user) { %>
                        <li class="relative group flex justify-center">
                            <button
                                class="bg-yellow-400 hover:bg-blue-500 text-blue-800 font-black py-2 px-6 rounded-full transition-all duration-300 hover:shadow-lg">
                                <%= user.firstName || 'Profile' %>
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7" />
                                    </svg>
                            </button>
                            <div
                                class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 z-50 transform -translate-y-2 group-hover:translate-y-0 flex justify-center flex-col">
                                <a href="/profile"
                                    class="block px-4 py-2 text-blue-800 hover:bg-blue-50 rounded-t-lg">My Profile</a>
                                <a href="/logout"
                                    class="block px-4 py-2 text-blue-800 hover:bg-blue-50 rounded-b-lg">Logout</a>
                            </div>
                        </li>
                        <% } else { %>
                            <li><a href="/login"
                                    class="bg-yellow-400 hover:bg-yellow-500 text-blue-800 font-black py-2 px-6 rounded-full transition-all duration-300 hover:shadow-lg flex justify-center">Login</a>
                            </li>
                            <% } %>
                </ul>
            </div>
        </div>
    </nav>

    <header class="pt-32 pb-24 text-white relative overflow-hidden">
        <div class="max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-lg mt-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Profile Initial Avatar -->
                <div class="md:col-span-1 flex flex-col items-center justify-start">
                    <div class="relative">
                        <div id="profileInitial"
                            class="w-40 h-40 flex items-center justify-center rounded-full border-4 border-yellow-400 shadow-md bg-blue-50 text-blue-900 text-6xl font-bold">
                            <%= user.firstName.charAt(0).toUpperCase() %>
                        </div>
                    </div>
                </div>

                <div class="md:col-span-2">
                    <h2 class="text-2xl font-bold text-blue-900 mb-6 pb-2 border-b-2 border-yellow-400">Edit Profile
                        Information</h2>



                    <form action="/profile/update" method="POST" id="profileForm">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- First Name -->
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <label class="block text-sm font-medium text-blue-700">First Name</label>
                                <input type="text" name="firstName" id="firstName" value="<%= user.firstName %>"
                                    class="mt-1 block text-black w-full border border-blue-300 rounded-md py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                <p id="firstNameError" class="text-xs mt-1 text-red-500 hidden">First name
                                    should contain only letters</p>
                            </div>

                            <!-- Last Name -->
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <label class="block text-sm font-medium text-blue-700">Last Name</label>
                                <input type="text" name="lastName" id="lastName" value="<%= user.lastName %>"
                                    class="mt-1 block text-black w-full border border-blue-300 rounded-md py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                <p id="lastNameError" class="text-xs mt-1 text-red-500 hidden">Last name should
                                    contain only letters</p>
                            </div>

                            <!-- Email -->
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <label class="block text-sm font-medium text-blue-700">Email Address</label>
                                <input type="email" name="email" id="email" value="<%= user.email %>"
                                    class="mt-1 block text-black w-full border border-blue-300 rounded-md py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                <p id="emailError" class="text-xs mt-1 text-red-500 hidden">Please enter a valid
                                    email address</p>
                            </div>

                            <!-- Phone -->
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <label class="block text-sm font-medium text-blue-700">Phone Number</label>
                                <input type="tel" name="phone" id="phone" value="<%= user.phone %>"
                                    class="mt-1 block text-black w-full border border-blue-300 rounded-md py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                <p id="phoneError" class="text-xs mt-1 text-red-500 hidden">Please enter a valid
                                    phone number (digits only)</p>
                            </div>

                            <!-- Gender -->
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <label class="block text-black text-sm font-medium text-blue-700">Gender</label>
                                <select name="gender" id="gender"
                                    class="mt-1 block text-black w-full border border-blue-300 rounded-md py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                    <option value="male" <%=user.gender==='male' ? 'selected' : '' %>>Male
                                    </option>
                                    <option value="female" <%=user.gender==='female' ? 'selected' : '' %>>Female
                                    </option>
                                    <option value="other" <%=user.gender==='other' ? 'selected' : '' %>>Other
                                    </option>
                                </select>
                            </div>

                            <div class="bg-blue-50 p-4 rounded-lg">
                                <label class="block text-sm font-medium text-blue-700">Member Since</label>
                                <p class="text-lg text-blue-900 font-semibold">
                                    25 March 2025
                                </p>
                            </div>

                            <!-- Password Change Section -->
                            <div class="md:col-span-2 border-t-2 border-yellow-400 pt-4 mt-4">
                                <h3 class="text-xl font-bold text-blue-900 mb-4">Change Password</h3>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="bg-blue-50 p-4 rounded-lg">
                                        <label class="block text-sm font-medium text-blue-700">Current
                                            Password</label>
                                        <input type="password" name="currentPassword" id="currentPassword"
                                            class="mt-1 block text-black w-full border border-blue-300 rounded-md py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                        <p id="currentPasswordError" class="text-xs mt-1 text-red-500 hidden">
                                        </p>
                                    </div>

                                    <div class="bg-blue-50 p-4 rounded-lg">
                                        <label class="block text-sm font-medium text-blue-700">New
                                            Password</label>
                                        <input type="password" name="newPassword" id="newPassword"
                                            class="mt-1 block text-black w-full border border-blue-300 rounded-md py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                        <div class="mt-1 h-2 bg-gray-200 rounded-full overflow-hidden">
                                            <div id="passwordStrength" class="h-full transition-all duration-300"></div>
                                        </div>
                                        <p id="passwordStrengthText" class="text-xs mt-1"></p>
                                        <p id="newPasswordError" class="text-xs mt-1 text-red-500 hidden"></p>
                                    </div>

                                    <div class="bg-blue-50 p-4 rounded-lg">
                                        <label class="block text-sm font-medium text-blue-700">Confirm New
                                            Password</label>
                                        <input type="password" name="confirmNewPassword" id="confirmNewPassword"
                                            class="mt-1 block text-black w-full border border-blue-300 rounded-md py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                        <p id="passwordMatchText" class="text-xs mt-1"></p>
                                    </div>
                                </div>

                                <div class="mt-2">
                                    <p class="text-sm text-gray-600">
                                        Note: Leave password fields blank if you don't want to change your
                                        password.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="mt-8 flex justify-end space-x-4">
                            <a href="/profile"
                                class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition">
                                Cancel
                            </a>
                            <button type="submit"
                                class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">
                                Save Changes
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </header>

    <script>
        // Validation functions
        function validateName(name) {
            return /^[A-Za-z]+$/.test(name);
        }

        function validateEmail(email) {
            // Basic email format validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) return false;

            // Extract domain part after @
            const domain = email.split('@')[1];

            // Check if domain ends with numbers only (like .000)
            if (/\.\d+$/.test(domain)) return false;

            // Check for valid TLD (top-level domain)
            const tld = domain.split('.').pop();
            const validTlds = ['com', 'org', 'net', 'edu', 'gov', 'co', 'io', 'ai', 'in', 'uk', 'us', 'ca', 'au', 'nz', 'de', 'fr', 'es', 'it', 'br', 'mx', 'jp', 'cn', 'ru'];

            // If TLD is not in our list of valid TLDs and is not at least 2 letters long
            if (!validTlds.includes(tld.toLowerCase()) && tld.length < 2) return false;

            return true;
        }

        // Email validation handler
        document.getElementById('email').addEventListener('blur', function () {
            const errorElement = document.getElementById('emailError');
            if (!validateEmail(this.value)) {
                errorElement.textContent = 'Please enter a valid email address (e.g., example@domain.com)';
                errorElement.classList.remove('hidden');
                this.classList.add('border-red-500');
            } else {
                errorElement.classList.add('hidden');
                this.classList.remove('border-red-500');
            }
        });

        function validatePhone(phone) {
            return /^\d+$/.test(phone);
        }

        // Field validation handlers
        document.getElementById('firstName').addEventListener('blur', function () {
            const errorElement = document.getElementById('firstNameError');
            if (!validateName(this.value)) {
                errorElement.classList.remove('hidden');
                this.classList.add('border-red-500');
            } else {
                errorElement.classList.add('hidden');
                this.classList.remove('border-red-500');
            }
        });

        document.getElementById('lastName').addEventListener('blur', function () {
            const errorElement = document.getElementById('lastNameError');
            if (!validateName(this.value)) {
                errorElement.classList.remove('hidden');
                this.classList.add('border-red-500');
            } else {
                errorElement.classList.add('hidden');
                this.classList.remove('border-red-500');
            }
        });

        document.getElementById('email').addEventListener('blur', function () {
            const errorElement = document.getElementById('emailError');
            if (!validateEmail(this.value)) {
                errorElement.classList.remove('hidden');
                this.classList.add('border-red-500');
            } else {
                errorElement.classList.add('hidden');
                this.classList.remove('border-red-500');
            }
        });

        document.getElementById('phone').addEventListener('blur', function () {
            const errorElement = document.getElementById('phoneError');
            if (!validatePhone(this.value)) {
                errorElement.classList.remove('hidden');
                this.classList.add('border-red-500');
            } else {
                errorElement.classList.add('hidden');
                this.classList.remove('border-red-500');
            }
        });



        document.getElementById('confirmNewPassword').addEventListener('input', checkPasswordMatch);

        function checkPasswordMatch() {
            const password = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmNewPassword').value;
            const matchText = document.getElementById('passwordMatchText');

            if (!password || !confirmPassword) {
                matchText.textContent = '';
                return;
            }

            if (password === confirmPassword) {
                matchText.textContent = 'Passwords match!';
                matchText.className = 'text-xs mt-1 text-green-500';
            } else {
                matchText.textContent = 'Passwords do not match!';
                matchText.className = 'text-xs mt-1 text-red-500';
            }
        }

        // Form submission validation
        document.getElementById('profileForm').addEventListener('submit', function (e) {
            let isValid = true;

            // Validate names
            if (!validateName(document.getElementById('firstName').value)) {
                document.getElementById('firstNameError').classList.remove('hidden');
                document.getElementById('firstName').classList.add('border-red-500');
                isValid = false;
            }

            if (!validateName(document.getElementById('lastName').value)) {
                document.getElementById('lastNameError').classList.remove('hidden');
                document.getElementById('lastName').classList.add('border-red-500');
                isValid = false;
            }

            // Validate email
            if (!validateEmail(document.getElementById('email').value)) {
                document.getElementById('emailError').classList.remove('hidden');
                document.getElementById('email').classList.add('border-red-500');
                isValid = false;
            }

            // Validate phone
            if (!validatePhone(document.getElementById('phone').value)) {
                document.getElementById('phoneError').classList.remove('hidden');
                document.getElementById('phone').classList.add('border-red-500');
                isValid = false;
            }

            // Password validation (only if any password field is filled)
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmNewPassword = document.getElementById('confirmNewPassword').value;

            if (currentPassword || newPassword || confirmNewPassword) {
                if (!currentPassword || !newPassword || !confirmNewPassword) {
                    document.getElementById('currentPasswordError').textContent = 'All password fields are required';
                    document.getElementById('currentPasswordError').classList.remove('hidden');
                    isValid = false;
                }

                if (newPassword.length < 4) {
                    document.getElementById('newPasswordError').textContent = 'Password must be at least 4 characters';
                    document.getElementById('newPasswordError').classList.remove('hidden');
                    isValid = false;
                }

                if (newPassword !== confirmNewPassword) {
                    document.getElementById('passwordMatchText').textContent = 'Passwords do not match!';
                    document.getElementById('passwordMatchText').className = 'text-xs mt-1 text-red-500';
                    isValid = false;
                }
            }


            if (!isValid) {
                e.preventDefault();
                // Scroll to the first error
                const firstError = document.querySelector('.border-red-500');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        });

        document.getElementById('currentPassword').addEventListener('blur', function () {
            const errorElement = document.getElementById('currentPasswordError');
            if (this.value && this.value.length < 4) {
                errorElement.textContent = 'Password must be at least 4 characters';
                errorElement.classList.remove('hidden');
                this.classList.add('border-red-500');
            } else {
                errorElement.classList.add('hidden');
                this.classList.remove('border-red-500');
            }
        });
    </script>

    <%- include('layout/footer.ejs') %>